<html>
  <head>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
	<script src="../java/GroundSceneReflector.js"></script>
    <script src="../java/a-frame-mirror.js"></script>
	<script>
AFRAME.registerComponent('mirror', {
schema:{
    renderothermirror:{default:true},
},
init: function () {
    var scene = this.el.sceneEl;
    scene.addEventListener('render-target-loaded',this.OnRenderLoaded.bind(this));
},
OnRenderLoaded: function()
{
    var mirrorObj = this.el.getOrCreateObject3D('mesh',THREE.Mesh);
    var cameraEl = document.querySelector('a-entity[camera]')
    if(!cameraEl)
    {
        cameraEl = document.querySelector('a-camera');
    }
    var camera = cameraEl.components.camera.camera;
    var scene = this.el.sceneEl;
    this.renderer = scene.renderer;
    this.mirror = new THREE.Mirror( this.renderer, camera, { clipBias: 0.003, textureWidth: window.innerWidth, textureHeight: window.innerHeight, color: 0x777777 } );
    mirrorObj.material =this.mirror.material;
    mirrorObj.add(this.mirror);
},
tick: function () {
    if(!this.data.renderothermirror)
        {
            this.mirror.render();
        }
    else
        {
            var mirrors = [];
            var mirrorEls = document.querySelectorAll("a-entity[mirror]");
            for(var i=0;i<mirrorEls.length;i++)
            {
                if(mirrorEls[i]!=this.el)
                {
                    mirrors.push(mirrorEls[i].components.mirror.mirror);
                }   
            }
            if(mirrors.length === 0)
            {
                this.mirror.render();
            }
            for(var i = 0; i<mirrors.length;i++)
            {
                this.mirror.renderWithMirror(mirrors[i]);
            }
        }
}
});
</script>
  </head>
  <body>
    <a-scene>
		<a-assets>
			<img id="metal" src="./imagens/metal1.png">
		</a-assets>

		<a-camera position="0 2 2"></a-camera>
		<a-sphere src="#metal" position="0 2 0" radius="1"  metalness="0.8" roughness="0" side="double" mirror></a-sphere>

		<a-sky color="#66ccff"></a-sky>
		<a-light type="ambient" color="white" intensity="0.4"></a-light>
		<a-light id="dirlight" type="directional" intensity="0.8" position="-1 0 0" shadow="cast: true"></a-light>
    </a-scene>
  </body>
</html>